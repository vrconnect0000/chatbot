<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SHOPP Express | Loja Oficial</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#131921">
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
      }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;700;800&family=Oswald:wght@700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { 
            --amazon-blue: #131921;
            --amazon-dark-blue: #232f3e;
            --amazon-yellow: #febd69;
            --deal-red: #CC0C39;
        }

        body { 
            background-color: #eaeded; 
            color: #111; 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            padding-bottom: 60px; /* Ajuste para a nova altura da barra */
        }

        .product-card { 
            background: #fff; 
            border: 1px solid #ddd; 
            padding: 1rem; 
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: box-shadow 0.3s ease;
        }
        .product-card:hover {
             box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        .product-card img { 
            width: 100%; 
            height: 140px; 
            object-fit: contain; 
            margin-bottom: 1rem;
        }

        @media (min-width: 768px) {
            .product-card img { height: 200px; }
        }

        .side-panel {
            position: fixed; right: 0; top: 0; height: 100%; width: 100%;
            background: #fff;
            z-index: 2000; padding: 25px;
            transform: translateX(100%); transition: 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            color: #111;
            box-shadow: -5px 0 15px rgba(0,0,0,0.2);
        }

        @media (min-width: 768px) { .side-panel { max-width: 450px; border-left: 1px solid #ddd; } }
        .side-panel.active { transform: translateX(0); }
        
        .btn-main {
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s;
            border-style: solid; 
            border-width: 1px;
        }

        .btn-primary {
            background: linear-gradient(to bottom,#f7dfa5,#f0c14b);
            border-color: #a88734 #9c7e31 #846a29;
            color: #111;
        }

        .btn-primary:hover {
            background: linear-gradient(to bottom,#f5d78e,#eeb933);
        }
        
        .grid-container { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 10px; 
            padding: 10px; 
        }

        @media (min-width: 768px) {
            .grid-container { 
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1.5rem; 
                padding: 1.5rem; 
            }
        }

        #success-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            z-index: 5000;
            display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .success-card {
            background: #fff;
            padding: 40px 30px; border-radius: 4px; text-align: center;
            max-width: 400px; width: 100%;
            color: #111;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        /* BARRA FIXA PREMIUM MELHORADA */
        .mini-footer { 
            background-color: rgba(19, 25, 33, 0.95); 
            backdrop-filter: blur(8px);
            color: #fff; 
            padding: 12px 0;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 90;
            border-top: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
        }
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .footer-brand {
            font-weight: 800;
            font-size: 14px;
            letter-spacing: 1px;
            color: var(--amazon-yellow);
        }
        .footer-info {
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 11px;
            font-weight: 500;
        }
        .footer-badge {
            background: rgba(255,255,255,0.1);
            padding: 4px 10px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        @media (max-width: 640px) {
            .footer-content { flex-direction: column; gap: 8px; text-align: center; }
            .footer-info { gap: 10px; }
            .footer-brand { font-size: 12px; }
        }
    </style>
</head>
<body>

    <div id="success-modal">
        <div class="success-card" data-aos="zoom-in">
            <div class="w-20 h-20 bg-green-500 text-white rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fa-solid fa-check text-3xl"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2">Pedido Confirmado!</h2>
            <p class="text-gray-600 text-sm leading-relaxed mb-8">Em breve, nossa equipe entrará em contato com você pelo WhatsApp para finalizar a compra.</p>
            <button onclick="document.getElementById('success-modal').style.display='none'" class="btn-main btn-primary w-full">Continuar Comprando</button>
        </div>
    </div>

    <div id="toast-container" class="fixed top-24 right-5 z-[9999] space-y-2"></div>

    <header class="bg-[var(--amazon-blue)] text-white p-2 sticky top-0 z-[100]">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                 <a href="#" class="text-2xl font-bold border border-transparent hover:border-white p-2 rounded-sm">SHOPP Express</a>
            </div>

            <div class="flex-grow mx-4 hidden md:flex">
                <div class="flex w-full">
                    <input type="text" oninput="filtrarBusca(this)" placeholder="Pesquisar" class="w-full p-2 rounded-l-md border-0 text-black focus:ring-2 focus:ring-yellow-500 outline-none">
                    <button class="bg-[var(--amazon-yellow)] hover:bg-yellow-500 p-2 rounded-r-md">
                        <i class="fa-solid fa-magnifying-glass text-black"></i>
                    </button>
                </div>
            </div>

            <div class="flex items-center space-x-2">
                <a href="#" class="hidden md:flex flex-col border border-transparent hover:border-white p-2 rounded-sm" onclick="toggleProfile()">
                    <p class="text-xs">Olá, faça seu login</p>
                    <p class="font-bold text-sm">Contas e Listas</p>
                </a>
                <div class="md:hidden flex items-center">
                    <button onclick="toggleProfile()" class="p-2"><i class="fa-regular fa-user text-2xl"></i></button>
                </div>
                <a href="#" onclick="toggleCart()" class="relative flex items-center border border-transparent hover:border-white p-2 rounded-sm">
                    <i class="fa-solid fa-shopping-cart text-2xl md:text-3xl"></i>
                    <span class="hidden md:inline font-bold mt-3 ml-1">Sacola</span>
                    <span class="cart-count-badge absolute top-0 right-0 md:top-1 md:right-8 text-yellow-400 font-bold text-base">0</span>
                </a>
            </div>
        </div>

        <div class="mt-2 md:hidden">
            <div class="flex w-full">
                <input type="text" oninput="filtrarBusca(this)" placeholder="Pesquisar..." class="w-full p-2 rounded-l-md border-0 text-black outline-none">
                <button class="bg-[var(--amazon-yellow)] p-2 rounded-r-md">
                    <i class="fa-solid fa-magnifying-glass text-black"></i>
                </button>
            </div>
        </div>
    </header>

    <section class="bg-[var(--amazon-dark-blue)] text-white p-2 flex items-center space-x-4 text-sm overflow-x-auto hide-scroll">
        <button onclick="filterByCategory('Todos')" class="font-bold px-2 py-1 border border-transparent hover:border-white rounded-sm">Todos</button>
        <div id="categories-list" class="flex gap-1"></div>
    </section>

    <div id="product-grid" class="grid-container"></div>

    <footer class="mini-footer">
        <div class="footer-content">
            <div class="footer-brand">SHOPP Express</div>
            
            <div class="footer-info">
                <div class="footer-badge">
                    <i class="fa-brands fa-whatsapp text-green-400"></i>
                    <span>(00) 00000-0000</span>
                </div>
                <div class="hidden sm:flex items-center gap-2 opacity-70">
                    <i class="fa-regular fa-clock"></i>
                    <span>Seg-Sáb: 08h às 18h</span>
                </div>
            </div>

            <div class="hidden lg:block text-[9px] opacity-40 font-bold">
                PLATAFORMA SEGURA &copy; 2026
            </div>
        </div>
    </footer>

    <div id="cart-panel" class="side-panel flex flex-col">
        <div class="flex justify-between items-center mb-8 border-b pb-4">
            <h2 class="text-2xl font-bold">Sacola de Compras</h2>
            <button onclick="toggleCart()" class="text-3xl opacity-70 hover:opacity-100">&times;</button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto space-y-4 pr-2"></div>
        <div class="mt-4 pt-4 border-t border-gray-200">
             <label class="text-sm font-bold block mb-2 text-gray-700">Forma de Pagamento</label>
            <select id="pagamento-select" class="w-full bg-gray-100 border border-gray-300 p-2 rounded-md text-sm focus:ring-2 focus:ring-yellow-500 outline-none">
                <option value="Pix">Pix</option>
                <option value="Cartão de Crédito">Cartão de Crédito</option>
                <option value="Crediário da Loja">Crediário da Loja</option>
                <option value="Dinheiro">Dinheiro</option>
            </select>
        </div>
        <div class="pt-6 border-t border-gray-200 mt-4">
            <div class="flex justify-between font-bold text-xl mb-6">
                <span>Subtotal</span>
                <span id="cart-total">R$ 0,00</span>
            </div>
            <button onclick="finalizarPedido()" id="btn-finalizar" class="btn-main btn-primary w-full">Finalizar Pedido</button>
        </div>
    </div>

    <div id="details-panel" class="side-panel overflow-y-auto hide-scroll pr-4">
        <button onclick="closeDetails()" class="text-sm font-bold text-gray-500 mb-6 uppercase hover:text-black">&larr; Voltar aos produtos</button>
        <div id="details-body"></div>
    </div>
    
    <div id="profile-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[3000] hidden flex items-center justify-center p-6">
        <div class="w-full max-w-sm bg-white p-8 rounded-lg text-black">
            <div id="profile-content"></div>
        </div>
    </div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({ once: true });
        const SUPABASE_URL = "https://zkhradhpwakvtgsilsyj.supabase.co"; 
        const SUPABASE_KEY = "sb_publishable_UrUxPsPD3XBTANwwp3tZOA_-REppnf3";
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let products = [], cart = [], currentCat = 'Todos';

        async function fetchProducts() {
            try {
                const { data } = await _supabase.from('produtos').select('*').order('id', { ascending: false });
                products = data || [];
                setupCategories();
                renderProducts(products);
            } catch (e) { console.error(e); }
        }

        function setupCategories() {
            const cats = [...new Set(products.map(p => p.categoria).filter(c => c))];
            document.getElementById('categories-list').innerHTML = cats.map(c => `
                <button onclick="filterByCategory('${c}')" class="px-2 py-1 text-sm rounded-sm border border-transparent hover:border-white whitespace-nowrap">${c}</button>
            `).join('');
        }

        function filterByCategory(cat) {
            currentCat = cat; 
            const filtered = cat === 'Todos' ? products : products.filter(p => p.categoria === cat);
            renderProducts(filtered);
        }

        function filtrarBusca(el) {
            const termo = el.value.toLowerCase();
            renderProducts(products.filter(p => p.nome.toLowerCase().includes(termo)));
        }

        function renderProducts(lista) {
            document.getElementById('product-grid').innerHTML = lista.map(p => {
                const precoNum = parseFloat(p.preco);
                const precoAntigoNum = p.preco_antigo ? parseFloat(p.preco_antigo) : 0;
                const temDesconto = precoAntigoNum > precoNum;
                return `
                    <div class="product-card cursor-pointer" onclick="showProductDetails(${p.id})" data-aos="fade-up">
                        <div class="h-32 md:h-48 flex items-center justify-center mb-4">
                            <img src="${p.imagem_url}" loading="lazy" class="max-h-full max-w-full">
                        </div>
                        <div class="flex-grow flex flex-col">
                          <h3 class="text-sm md:text-base font-medium mb-2 text-gray-800 line-clamp-2 h-10 md:h-12 overflow-hidden">${p.nome}</h3>
                          <div class="flex flex-col mt-1">
                              ${temDesconto ? `<span class="text-[10px] md:text-xs line-through text-gray-500">R$${precoAntigoNum.toFixed(2).replace('.', ',')}</span>` : ''}
                              <span class="text-lg md:text-xl font-bold">R$${precoNum.toFixed(2).replace('.', ',')}</span>
                          </div>
                        </div>
                        <button onclick="event.stopPropagation(); addToCart(${p.id})" class="btn-main btn-primary mt-4 w-full text-xs md:text-sm">Adicionar</button>
                    </div>
                `;
            }).join('');
        }

        function showProductDetails(id) {
            const p = products.find(x => x.id === id);
            const imgs = [p.imagem_url, p.imagem_url_2, p.imagem_url_3, p.imagem_url_4].filter(u => u);
            const precoNum = parseFloat(p.preco);
            document.getElementById('details-body').innerHTML = `
                <div class="space-y-6">
                    <div class="w-full aspect-square bg-white rounded-lg flex items-center justify-center overflow-hidden border border-gray-200">
                        <img id="main-view-img" src="${p.imagem_url}" class="w-full h-full object-contain">
                    </div>
                    <div class="flex gap-2 overflow-x-auto hide-scroll pb-2">${imgs.map((u, i) => `<div class="w-16 h-16 shrink-0 border border-gray-300 rounded-md cursor-pointer hover:border-yellow-500 bg-white p-1 flex items-center justify-center"><img src="${u}" onclick="document.getElementById('main-view-img').src='${u}'" class="max-h-full"></div>`).join('')}</div>
                    <h2 class="text-2xl md:text-3xl font-bold">${p.nome}</h2>
                    <p class="text-xl md:text-2xl font-bold text-green-700">R$ ${precoNum.toFixed(2).replace('.', ',')}</p>
                    <p class="text-sm text-gray-600 leading-relaxed">${p.descricao || ''}</p>
                    <button onclick="addToCart(${p.id})" class="btn-main btn-primary w-full">Adicionar à Sacola</button>
                </div>
            `;
            document.getElementById('details-panel').classList.add('active');
        }

        function renderProfile() {
            const data = JSON.parse(localStorage.getItem('oque_profile'));
            const content = document.getElementById('profile-content');
            if (data?.nome) {
                content.innerHTML = `
                    <div class="text-center mb-6">
                      <h2 class="font-bold text-xl mb-4">Olá, ${data.nome.split(' ')[0]}</h2>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg border border-gray-200 mb-6 space-y-2 text-sm">
                        <p class="font-bold text-xs uppercase text-gray-500">Seus Dados</p>
                        <p><i class="fa-brands fa-whatsapp text-green-500"></i> ${data.whatsapp}</p>
                        <p><i class="fa-solid fa-location-dot"></i> ${data.rua}, ${data.numero}</p>
                        <p>${data.bairro}</p>
                    </div>
                    <button onclick="localStorage.removeItem('oque_profile');renderProfile()" class="w-full text-sm text-red-500 font-bold uppercase mb-4">Sair</button>
                    <button onclick="toggleProfile()" class="w-full text-center p-2 rounded-md border border-gray-300 hover:bg-gray-100">Voltar</button>
                `;
            } else {
                content.innerHTML = `
                    <h2 class="text-center font-bold text-xl mb-6 uppercase">Seus Dados de Entrega</h2>
                    <div class="space-y-3">
                        <input type="text" id="p-nome" placeholder="Nome Completo" class="w-full bg-gray-100 p-3 rounded-md border border-gray-300 text-sm focus:ring-2 focus:ring-yellow-500 outline-none">
                        <input type="tel" id="p-whatsapp" placeholder="WhatsApp" class="w-full bg-gray-100 p-3 rounded-md border border-gray-300 text-sm focus:ring-2 focus:ring-yellow-500 outline-none">
                        <input type="text" id="p-rua" placeholder="Rua" class="w-full bg-gray-100 p-3 rounded-md border border-gray-300 text-sm focus:ring-2 focus:ring-yellow-500 outline-none">
                        <div class="flex gap-2">
                           <input type="text" id="p-numero" placeholder="Nº" class="w-1/3 bg-gray-100 p-3 rounded-md border border-gray-300 text-sm focus:ring-2 focus:ring-yellow-500 outline-none">
                           <input type="text" id="p-bairro" placeholder="Bairro" class="w-2/3 bg-gray-100 p-3 rounded-md border border-gray-300 text-sm focus:ring-2 focus:ring-yellow-500 outline-none">
                        </div>
                        <button onclick="saveProfile()" class="btn-main btn-primary w-full mt-4">Salvar Informações</button>
                        <button onclick="toggleProfile()" class="w-full text-xs text-gray-500 uppercase mt-4 text-center">Fechar</button>
                    </div>
                `;
            }
        }

        function saveProfile() {
            const d = { 
                nome: document.getElementById('p-nome').value, 
                whatsapp: document.getElementById('p-whatsapp').value,
                rua: document.getElementById('p-rua').value, 
                numero: document.getElementById('p-numero').value, 
                bairro: document.getElementById('p-bairro').value
            };
            if(!d.nome || !d.whatsapp) return alert("Preencha Nome e WhatsApp.");
            localStorage.setItem('oque_profile', JSON.stringify(d)); renderProfile();
        }

        function addToCart(id) {
            const product = products.find(x => x.id === id);
            cart.push(product);
            updateCartUI(); 
            showToast(`Adicionado!`);
        }
        
        function showToast(message) {
            const container = document.getElementById('toast-container');
            const t = document.createElement('div'); 
            t.className = "bg-white text-black p-3 rounded-md shadow-lg text-sm font-bold flex items-center gap-2";
            t.innerHTML = `<i class="fa-solid fa-check text-green-500"></i> ${message}`;
            container.appendChild(t); 
            setTimeout(() => t.remove(), 3000);
        }

        function updateCartUI() {
            let total = 0;
            document.getElementById('cart-items').innerHTML = cart.map((item, i) => {
                total += parseFloat(item.preco);
                return `<div class="flex items-center gap-4 bg-gray-100 p-2 rounded-md border border-gray-200"><img src="${item.imagem_url}" class="w-16 h-16 object-contain rounded bg-white p-1"><div class="flex-1 text-sm font-bold truncate">${item.nome}</div><button onclick="cart.splice(${i},1);updateCartUI()" class="text-red-500 text-xl">&times;</button></div>`;
            }).join('');
            document.getElementById('cart-total').innerText = `R$ ${total.toFixed(2).replace('.', ',')}`;
            document.querySelectorAll('.cart-count-badge').forEach(b => b.innerText = cart.length);
        }

        async function finalizarPedido() {
            const user = JSON.parse(localStorage.getItem('oque_profile'));
            if(!user?.nome) { toggleCart(); setTimeout(toggleProfile, 500); return; }
            if(!cart.length) return alert("Sua sacola está vazia!");
            const btn = document.getElementById('btn-finalizar');
            btn.disabled = true; btn.innerHTML = "PROCESSANDO...";
            const { error } = await _supabase.from('vendas').insert([{
                cliente_nome: user.nome,
                cliente_whatsapp: user.whatsapp,
                endereco: `${user.rua}, ${user.numero} - ${user.bairro}`,
                itens: cart.map(i => i.nome).join(', '),
                total: cart.reduce((a, b) => a + parseFloat(b.preco), 0),
                pagamento: document.getElementById('pagamento-select').value,
                status: 'Pendente'
            }]);
            if(!error) {
                document.getElementById('success-modal').style.display = 'flex';
                cart = []; updateCartUI(); toggleCart();
            } else { alert("Erro ao processar."); }
            btn.disabled = false; btn.innerHTML = "Finalizar Pedido";
        }

        function toggleCart() { document.getElementById('cart-panel').classList.toggle('active'); }
        function toggleProfile() { renderProfile(); document.getElementById('profile-modal').classList.toggle('hidden'); }
        function closeDetails() { document.getElementById('details-panel').classList.remove('active'); }
        window.onload = fetchProducts;
    </script>
</body>
</html>